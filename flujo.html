<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<title>Flujo Isentrópico</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
  body { font-family: Arial, sans-serif; margin: 20px; }
  input, button { margin: 5px; padding: 5px; }
  table { border-collapse: collapse; margin-top: 20px; width: 100%; display: none; }
  th, td { border: 1px solid black; padding: 5px; text-align: center; }
  canvas { max-width: 600px; margin-top: 20px; display: none; }
  .header-text {
    text-align: center;
    font-weight: bold;
    margin-bottom: 25px;
    line-height: 1.3;
    white-space: pre-line;
  }
</style>
</head>
<body>

<div class="header-text">
UNIVERSIDAD DE EL SALVADOR
FACULTAD DE INGENIERÍA Y ARQUITECTURA
ESCUELA DE INGENIERÍA MECÁNICA
DEPARTAMENTO DE SISTEMAS TERMOMECÁNICOS
TERMODINÁMICA 2
Docente: M.Sc e ingeniero Gustavo Salomón Torres

Estudiante: Cristian José Morales Molina – MM21012
</div>

<h2>Calculadora de Flujo Isentrópico</h2>

<label>Mach (M):</label>
<input type="number" id="mach" step="0.01" value="0">

<label>Gamma (γ):</label>
<input type="number" id="gamma" step="0.01" value="1.4">

<br>
<button onclick="calcular()">Calcular</button>
<button onclick="mostrarGraficas()">Gráficas</button>
<button onclick="borrarDatos()">Borrar</button>

<table id="tablaResultados">
  <thead>
    <tr>
      <th>Mach (M)</th>
      <th>M*</th>
      <th>T/T₀</th>
      <th>P/P₀</th>
      <th>ρ/ρ₀</th>
      <th>a/a₀</th>
      <th>A/A*</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<canvas id="graficaT"></canvas>
<canvas id="graficaP"></canvas>
<canvas id="graficaRho"></canvas>
<canvas id="graficaAao"></canvas>
<canvas id="graficaAaestrella"></canvas>
<canvas id="graficaMestrella"></canvas>

<script>
let chartInstances = {};

function calcular() {
  let M = parseFloat(document.getElementById('mach').value);
  let gamma = parseFloat(document.getElementById('gamma').value);

  if (isNaN(M) || M < 0) {
    alert("El número de Mach debe ser mayor o igual a cero y positivo.");
    return;
  }
  if (isNaN(gamma) || gamma <= 1) {
    alert("El valor de γ debe ser mayor que 1.");
    return;
  }

  const T_T0 = 1 / (1 + ((gamma - 1) / 2) * M * M);
  const P_P0 = Math.pow(T_T0, gamma / (gamma - 1));
  const rho_rho0 = Math.pow(T_T0, 1 / (gamma - 1));
  const a_a0 = Math.sqrt(T_T0);
  let A_Aestrella;
  if (M === 0) {
    A_Aestrella = "∞";
  } else {
    A_Aestrella = (1 / M) * Math.pow((2 / (gamma + 1)) * (1 + ((gamma - 1) / 2) * M * M), (gamma + 1) / (2 * (gamma - 1)));
  }
  const M_estrella = Math.sqrt(((gamma + 1) * M * M) / (2 + (gamma - 1) * M * M));

  const tbody = document.querySelector("#tablaResultados tbody");
  tbody.innerHTML = `<tr>
    <td>${M.toFixed(3)}</td>
    <td>${M_estrella.toFixed(5)}</td>
    <td>${T_T0.toFixed(5)}</td>
    <td>${P_P0.toFixed(5)}</td>
    <td>${rho_rho0.toFixed(5)}</td>
    <td>${a_a0.toFixed(5)}</td>
    <td>${A_Aestrella === "∞" ? "∞" : A_Aestrella.toFixed(5)}</td>
  </tr>`;

  document.getElementById("tablaResultados").style.display = "table";

  Object.values(chartInstances).forEach(chart => chart.destroy());
  chartInstances = {};
  hideCanvases();
}

function mostrarGraficas() {
  let gamma = parseFloat(document.getElementById('gamma').value);
  if (isNaN(gamma) || gamma <= 1) {
    alert("El valor de γ debe ser mayor que 1.");
    return;
  }

  const machs = [];
  const M_estrella = [];
  const T = [];
  const P = [];
  const rho = [];
  const a_a0 = [];
  const A_Aestrella = [];

  for (let M = 0.1; M <= 5; M += 0.1) {
    machs.push(parseFloat(M.toFixed(2)));
    let T_T0 = 1 / (1 + ((gamma - 1) / 2) * M * M);
    T.push(T_T0);
    P.push(Math.pow(T_T0, gamma / (gamma - 1)));
    rho.push(Math.pow(T_T0, 1 / (gamma - 1)));
    a_a0.push(Math.sqrt(T_T0));
    A_Aestrella.push((1 / M) * Math.pow((2 / (gamma + 1)) * (1 + ((gamma - 1) / 2) * M * M), (gamma + 1) / (2 * (gamma - 1))));
    M_estrella.push(Math.sqrt(((gamma + 1) * M * M) / (2 + (gamma - 1) * M * M)));
  }

  crearGrafica("graficaMestrella", "M* vs Mach", machs, M_estrella);
  crearGrafica("graficaT", "T/T₀ vs Mach", machs, T);
  crearGrafica("graficaP", "P/P₀ vs Mach", machs, P);
  crearGrafica("graficaRho", "ρ/ρ₀ vs Mach", machs, rho);
  crearGrafica("graficaAao", "a/a₀ vs Mach", machs, a_a0);
  crearGrafica("graficaAaestrella", "A/A* vs Mach", machs, A_Aestrella);

  document.getElementById("tablaResultados").style.display = "none";
}

function crearGrafica(canvasId, titulo, etiquetas, datos) {
  if (chartInstances[canvasId]) {
    chartInstances[canvasId].destroy();
  }

  const ctx = document.getElementById(canvasId).getContext("2d");
  document.getElementById(canvasId).style.display = "block";

  chartInstances[canvasId] = new Chart(ctx, {
    type: 'line',
    data: {
      labels: etiquetas,
      datasets: [{
        label: titulo,
        data: datos,
        borderColor: (titulo.includes("M*") ? 'red' : 'blue'),
        fill: false,
        pointRadius: 0,
        borderWidth: 2,
        tension: 0.1
      }]
    },
    options: {
      responsive: true,
      scales: {
        x: { title: { display: true, text: 'Número de Mach' } },
        y: { title: { display: true, text: titulo.split(" vs ")[0] } }
      }
    }
  });
}

function borrarDatos() {
  document.getElementById('mach').value = "0";
  document.getElementById('gamma').value = "1.4";
  document.getElementById("tablaResultados").style.display = "none";

  Object.values(chartInstances).forEach(chart => chart.destroy());
  chartInstances = {};
  hideCanvases();
}

function hideCanvases() {
  ["graficaT", "graficaP", "graficaRho", "graficaAao", "graficaAaestrella", "graficaMestrella"].forEach(id => {
    document.getElementById(id).style.display = "none";
  });
}
</script>

</body>
</html>
